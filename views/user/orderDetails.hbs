{{> layouts}}

<style>
    .gradient-custom-2 {
        /* fallback for old browsers */
        background: #a1c4fd;

        /* Chrome 10-25, Safari 5.1-6 */
        background: -webkit-linear-gradient(to right, rgba(161, 196, 253, 1), rgba(194, 233, 251, 1));

        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        background: linear-gradient(to right, rgba(161, 196, 253, 1), rgba(194, 233, 251, 1))
    }

    #progressbar-1 {
        color: #455A64;
    }

    #progressbar-1 li {
        list-style-type: none;
        font-size: 13px;
        width: 33.33%;
        float: left;
        position: relative;
    }

    #progressbar-1 #step1:before {
        content: "1";
        color: #fff;
        width: 29px;
        margin-left: 22px;
        padding-left: 11px;
    }

    #progressbar-1 #step2:before {
        content: "2";
        color: #fff;
        width: 29px;
    }

    #progressbar-1 #step3:before {
        content: "3";
        color: #fff;
        width: 29px;
        margin-right: 22px;
        text-align: center;
    }

    #progressbar-1 li:before {
        line-height: 29px;
        display: block;
        font-size: 12px;
        background: #455A64;
        border-radius: 50%;
        margin: auto;
    }

    #progressbar-1 li:after {
        content: '';
        width: 121%;
        height: 2px;
        background: #455A64;
        position: absolute;
        left: 0%;
        right: 0%;
        top: 15px;
        z-index: -1;
    }

    #progressbar-1 li:nth-child(2):after {
        left: 50%
    }

    #progressbar-1 li:nth-child(1):after {
        left: 25%;
        width: 121%
    }

    #progressbar-1 li:nth-child(3):after {
        left: 25%;
        width: 50%;
    }

    #progressbar-1 li.active:before,
    #progressbar-1 li.active:after {
        background: #1266f1;
    }

    .card-stepper {
        z-index: 0
    }
</style>
{{!-- //status bar style --}}
<style>
    body {
        color: #000;
        overflow-x: hidden;
        height: 100%;
        background-color: #ffffff;
        background-repeat: no-repeat;
    }

    .card {
        z-index: 0;
        background-color: #ffffff;
        padding-bottom: 20px;
        margin-top: 90px;
        margin-bottom: 90px;
        border-radius: 10px;
    }

    .top {
        padding-top: 40px;
        padding-left: 13% !important;
        padding-right: 13% !important;
    }

    /*Icon progressbar*/
    #progressbar {
        margin-bottom: 30px;
        overflow: hidden;
        color: #455A64;
        padding-left: 0px;
        margin-top: 30px;
    }

    #progressbar li {
        list-style-type: none;
        font-size: 13px;
        width: 25%;
        float: left;
        position: relative;
        font-weight: 400;
    }

    #progressbar .step0:before {
        font-family: FontAwesome;
        content: "\f10c";
        color: rgb(255, 255, 255);
    }

    #progressbar li:before {
        width: 40px;
        height: 40px;
        line-height: 45px;
        display: block;
        font-size: 20px;
        background: #ffffff;
        border-radius: 50%;
        margin: auto;
        padding: 0px;
    }

    /*ProgressBar connectors*/
    #progressbar li:after {
        content: '';
        width: 100%;
        height: 12px;
        background: #e1e1e1;
        position: absolute;
        left: 0;
        top: 16px;
        z-index: -1;
    }

    #progressbar li:last-child:after {
        border-top-right-radius: 10px;
        border-bottom-right-radius: 10px;
        position: absolute;
        left: -50%;
    }

    #progressbar li:nth-child(2):after,
    #progressbar li:nth-child(3):after
      #progressbar li:nth-child(4):after {
        left: -50%;
    }

    #progressbar li:first-child:after {
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
        position: absolute;
        left: 50%;
    }

    #progressbar li:last-child:after {
        border-top-right-radius: 10px;
        border-bottom-right-radius: 10px;
    }

    #progressbar li:first-child:after {
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
    }

    /*Color number of the step and the connector before it*/
    #progressbar li.active:before,
    #progressbar li.active:after {
        background: #293afc;
    }

    #progressbar li.active:before {
        font-family: FontAwesome;
        content: "\f00c";
    }

    .icon {
        width: 60px;
        height: 60px;
        margin-right: 15px;
    }

    .icon-content {
        padding-bottom: 20px;
    }

    @media screen and (max-width: 992px) {
        .icon-content {
            width: 50%;
        }
    }
</style>

<body>

    {{> userHeader}}

    {{#each order}}
    <div style="width: 75%;" class="container  h-80">
        <div class="row d-flex bi-justify-left align-items-center h-100">
            <div class="card card-stepper" style="border-radius: 16px;border: none;">
                <div class="card-header p-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted mb-2"> Order ID <span class="fw-bold text-body">{{this._id}}</span>
                            </p>
                            <p class="text-muted mb-0"> Place On <span class="fw-bold text-body">
                                    {{this.date}}</span> </p>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">

                    {{#each this.products}}
                    <div class="d-flex flex-row mb-4 pb-2">
                        <div class="flex-fill">
                            <a style="text-decoration: none;" href="/productdetails?id={{this.item._id}}">
                                <h5 class="bold">{{this.item.name}}</h5>
                            </a>

                            <p class="text-muted"> Qt: {{this.item.quantity}} item</p>
                            <h4 class="mb-3"> â‚¹ {{this.item.price}} <span class="small text-muted"> via
                                    ({{../this.payment}}) </span></h4>
                            <p class="text-muted">Tracking Status on: <span
                                    class="text-body">{{../this.date}}</span>
                            </p>
                        </div>
                        <div>
                            <a style="text-decoration: none;" href="/productdetails?id={{this.item._id}}">
                                <img class="align-self-center img-fluid"
                                    src="/admin/productImage/{{this.item.product_image.[0].filename}}" width="250"></a>
                        </div>
                    </div>
                    {{/each}}

                   
                    
                            <!-- Add class 'active' to progress -->
                            <div class="row d-flex justify-content-center">
                                <div class="col-12">
                                    <ul id="progressbar" class="text-center">
                                        {{#if this.placed}}
                                        <li class="active step0"><span>Recieved</span></li>
                                        {{else}}
                                         <li class="step"><span>Recieved</span></li>
                                         {{/if}}
                                         {{#if this.Processed}}
                                        <li class="active step0"><span>Processed</span></li>
                                        {{else}}
                                        <li class="step"><span>Processed</span></li>
                                         {{/if}}
                                         {{#if this.Shipped}}
                                        <li class="active step0"><span>Shipped</span></li>
                                        {{else}}
                                         <li class="step"><span>Shipped</span></li>
                                         {{/if}}
                                         {{#if this.Delivered}}
                                        <li class=" active step0"><span>Delivered</span></li>
                                        {{else}}
                                        <li class="step"><span>Delivered</span></li>
                                        {{/if}}
                                        {{#if this.cancelled}}
                                      <li class=" active step0 d-none"><span>Delivered</span></li>
                                        <h4 class="text-danger mt-2">Order Cancelled</h4>
                                        {{else}}
                                        <div class="d-none"></div>
                                        {{/if}}

                                    </ul>
                                    
                                    
                                    
                                </div>
                            </div>
            
                </div>
                <div class="card-footer p-2">
                    <div class="d-flex justify-content-between">
                        <div class="border-start h-100"></div>
                        <h5 class="fw-normal mb-0"><a onclick="cancelOrder('{{this._id}}')"
                                style="text-decoration: none;color: red;cursor: pointer;">Cancel </a></h5>
                        <div class="border-start h-100"></div>
                        <div class="border-start h-100"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{/each}}





    {{> userFooter}}
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function cancelOrder(orderId) {
            Swal.fire({
                title: 'Are you sure want to cancel order?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, Cancel it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '/cancel-order',
                        method: 'post',
                        data: {
                            orderId: orderId
                        },
                        success: (response) => {
                            Swal.fire(
                                'Deleted!',
                                'Your file has been deleted.',
                                'success'
                            )
                            setTimeout(() => location.reload(), 1200)

                        }

                    })

                }
            })


        }
    </script>
</body>